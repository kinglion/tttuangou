<!--{template @admin/header}--> <style type="text/css">
.status-box a {
color: #000;
text-decoration: none;
padding: 2px 3px;
border: 1px solid #ccc;
}
.status-box a.selected {
color: #688;
background: #ccc;
border: 1px solid #999;
}
.replys {
border: 1px dashed #ccc;
padding: 2px 3px;
color: #999;
}
</style> <div class="header"> <a href="?mod=comment&code=vlist">è¯„è®ºåˆ—è¡¨</a> / [ <a href="?mod=comment&code=config">åŠŸèƒ½è®¾ç½®</a> ]
</div> <table id="orderTable" cellspacing="1" cellpadding="4" width="100%" align="center" class="tableborder"> <thead> <tr class="tr_nav"> <td width="120">äº§å“</td> <td width="50">ç”¨æˆ·</td> <td width="30">è¯„åˆ†</td> <td>å†…å®¹</td> <td width="108">çŠ¶æ€?/td> <td width="33">æ’åº</td> <td width="110">ç®¡ç†</td> </tr> </thead> <tbody> <!--{loop $comments $one}--> <tr id="comment-tr-{$one['id']}"> <td> <a href="index.php?view={$one['product_id']}" target="_blank">{$one['product']['flag']}</a> </td> <td>
{if $one['user_id']}
{echo app('ucard')->load($one['user_id'])}
{else}
{$one['user_name']}
{/if}
</td> <td>
{$one['score']}
</td> <td>
{if strlen($one['content']) > 64}
{echo cut_str($one['content'], 64, '<a href="#comment-view" onclick="comment_detail_view('.$one['id'].');return false;">...æŸ¥çœ‹æ›´å¤š</a>')}
{else}
{$one['content']}
{/if}
{if $one['reply']}
<div class="replys">
{$one['reply']}
</div>
{/if}
</td> <td class="status-box status-ctrl"> <a cid="{$one['id']}" cst="auditing" class="{if $one['status']=='auditing'}selected{/if}">å¾…å®¡</a> <a cid="{$one['id']}" cst="approved" class="{if $one['status']=='approved'}selected{/if}">é€šè¿‡</a> <a cid="{$one['id']}" cst="denied" class="{if $one['status']=='denied'}selected{/if}">æ‹’ç»</a> </td> <td class="status-box toped-ctrl"> <a cid="{$one['id']}" class="{if $one['toped']==1}selected{/if}">ç½®é¡¶</a> </td> <td class="manager-ctrl"> <a href="#comment-modify" cid="{$one['id']}" action="modify">[ ç¼–è¾‘/å›å¤ ]</a> <a href="#comment-delete" cid="{$one['id']}" action="delete">[ åˆ é™¤ ]</a> </td> </tr> <!--{/loop}--> </tbody> <tfoot> <tr> <td colspan="7">{~page_moyo()}</td> </tr> </tfoot> </table> <script type="text/javascript">
$(document).ready(function(){
$.each($('.status-ctrl a'), function(i, dom){
$(dom).attr('href', '#comment-status-change');
$(dom).bind('click', status_box_click);
});
$.each($('.toped-ctrl a'), function(i, dom){
$(dom).attr('href', '#comment-toped-change');
$(dom).bind('click', toped_box_click);
});
$.each($('.manager-ctrl a'), function(i, dom){
$(dom).bind('click', manager_link_click);
});
});
function status_box_click(event)
{
var dom = event.target;
var cg_id = $(dom).attr('cid');
var cg_status = $(dom).attr('cst');
var ls_status = $('.status-ctrl a[cid='+cg_id+'].selected').attr('cst');
if (ls_status != cg_status)
{
$.notify.loading('æ­£åœ¨åŒæ­¥çŠ¶æ€?..');
$.get('admin.php?mod=comment&code=status&op=sync&id='+cg_id+'&status='+cg_status, function(result){
$.notify.loading(false);
$('.status-ctrl a[cid='+cg_id+'][cst='+ls_status+']').removeClass('selected');
$('.status-ctrl a[cid='+cg_id+'][cst='+cg_status+']').addClass('selected');
});
}
return false;
}
function toped_box_click(event)
{
var dom = event.target;
var cid = $(dom).attr('cid');
var dst = $(dom).hasClass('selected') ? 'false' : 'true';
$.notify.loading('æ­£åœ¨åŒæ­¥æ’åº...');
$.get('admin.php?mod=comment&code=toped&op=sync&id='+cid+'&switch='+dst, function(result){
$.notify.loading(false);
if (dst == 'true')
{
$(dom).addClass('selected');
}
else
{
$(dom).removeClass('selected');
}
});
}
var comment_mgr_box = null;
function manager_link_click(event)
{
var dom = event.target;
var action = $(dom).attr('action');
var cid = $(dom).attr('cid');
if (action == 'delete')
{
artDialog.confirm('ç¡®è®¤åˆ é™¤å—ï¼Ÿ', function(){
comment_mgr_box = artDialog.load('admin.php?mod=comment&code=ajax&op='+action+'&id='+cid, {title:action});
});
}
else
{
comment_mgr_box = artDialog.load('admin.php?mod=comment&code=ajax&op='+action+'&id='+cid, {title:action});
}
return false;
}
function comment_mgr_form_submit()
{
var url = $('#comment-mgr-form').attr('action');
var formhash = $('#comment-mgr-form input[name=FORMHASH]').val();
var fields = {'FORMHASH':formhash};
$.each($('#comment-mgr-form .ca-items'), function(i, input){
fields[$(input).attr('name')] = $(input).val();
});
$.notify.loading('æ­£åœ¨ä¿å­˜æ•°æ®...');
$.post(url, fields, function(result) {
$.notify.loading(false);
if (result == 'ok')
{
comment_mgr_box && comment_mgr_box.close();
$.notify.success('ä¿å­˜æˆåŠŸï¼?);
}
else
{
$.notify.failed(result);
}
});
}
function comment_delete_result(result, id)
{
if (result == 'ok')
{
comment_mgr_box && comment_mgr_box.close();
$.notify.success('åˆ é™¤æˆåŠŸï¼?);
var dom = $('#comment-tr-'+id);
dom.css({'position':'absolute','left':dom.offset().left,'top':dom.offset().top}).animate({'top':-123}, function(){ dom.remove() });
}
else
{
$.notify.failed(result);
}
}
function comment_detail_view(id)
{
artDialog.load('admin.php?mod=comment&code=ajax&op=view&id='+id, {title:'æŸ¥çœ‹è¯„ä»·å†…å®¹'});
}
</script>
{template @admin/footer}